{% extends "base2.html" %}
{% block content %}
{% load static %}
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link
		href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Sora:wght@100..800&display=swap"
		rel="stylesheet"
	/>
	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
		rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
		crossorigin="anonymous"
	/>
	<title>Find campaign</title>
</head>
			<main class="light-bg-clr pd-down">
				<span class="page-highlight-span">Search</span>
				<section>
					<h2 class="page-head">Search on Feed Needs Without Borders</h2>
					<form method="get">
					<div class="search-util-wrapper">
						<div class="search-bar flex-between">
							<input placeholder="Type keyword/location" type="text" class="search-input">
							<button class="search-btn">Search</button>
						</div>
	
						<div data-select="category" class="category select-wrapper">
							<div class="select-head flex-between gp-10">
								<span class="mac-text-mid">Category</span>
								<span class="flex-center">
									<img class="down-arrow-icon" src="../static/img/svg/down-arrow-gray.svg" alt="down arrow icon">
								</span>
							</div>

							<div data-select="category-dropdown" class="select-dropdown">
								<div class="select-dropdown-item flex-column align-start gp-20">
									<label class="terms-label" name = "select-all" for="select-all">
										Select all
										<input id="select-all" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" name = "party" for="social-initiatives">
										Social initiatives
										<input id="social-initiatives" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="disaster-relief">
										Disaster relief
										<input id="disaster-relief" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="life-threatening">
										Life threatening
										<input id="life-threatening" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="medical-emergencies">
										Medical Emergencies
										<input id="medical-emergencies" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="organization">
										Organization
										<input id="organization" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="education">
										Education
										<input id="education" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="art&culture">
										Art & Culture
										<input id="art&culture" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>
								</div>
							</div>
						</div>
	
						<div data-select="sector" class="sector select-wrapper ">
							<div class="select-head flex-between gp-10">
								<span class="mac-text-mid">Sector</span>
								<span class="flex-center">
									<img class="down-arrow-icon" src="../static/img/svg/down-arrow-gray.svg" alt="down arrow icon">
								</span>
							</div>

							<div data-select="sector-dropdown" class="select-dropdown">
								<div class="select-dropdown-item flex-column align-start gp-20">
									<label class="terms-label" name = "select-all" for="select-all-2">
										Select all
										<input id="select-all-2" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" name = "party" for="child-welfare">
										Child welfare
										<input id="child-welfare" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="education-2">
										Education
										<input id="education-2" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="Community-development">
										Community development
										<input id="Community-development" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="environmental">
										Environmental
										<input id="environmental" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="medical">
										Medical
										<input id="medical" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="education">
										Education
										<input id="education" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>

									<label class="terms-label" for="art&culture">
										Art & Culture
										<input id="art&culture" type="checkbox" />
										<span class="terms-checkmark"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</form>
					<span class="category-highlight">Trending</span>
				</section>

				<section>
					
					<div class="find-campaign-items-container">
						

						{% if campaigns_with_percentage %}
						{% for campaigns in campaigns_with_percentage  %}
						<div class="find-campaign-item">
							<a  href="{% url 'details' campaigns.campaign.token %}" class="find_campaign-item-link">
								<img
								class="feature-img mt-2"
								src="{{campaigns.campaign.images.url}}"
								alt="feature image"
								/>
							</a>
							<div class="feature-desc-container">
								<a href="{% url 'details' campaigns.campaign.token %}">
								<h5 class="page-sub-h5-head">
									{{campaigns.campaign.campaign_name}}
								</h5>
							</a>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											{{campaigns.campaign.country}}
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endfor %}
						{% else %}

						<div class="find-campaign-item">
							<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									Helping children to school
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											Ghana
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="find-campaign-item">
							<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									Helping children to school
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											Ghana
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="find-campaign-item">
							<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									Helping children to school
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											Ghana
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="find-campaign-item">
							<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									Helping children to school
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											Ghana
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="find-campaign-item">
							<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									Helping children to school
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											Ghana
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="find-campaign-item">
							<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									Helping children to school
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											Ghana
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endif %}
					</div>
				</section>
			</main>

		

<script>
	document.querySelector('.search-btn').addEventListener('click', async (event) => {
		event.preventDefault();
	
		// Collect user input
		const keyword = document.querySelector('.search-input').value;
		const selectedCategories = Array.from(
			document.querySelectorAll('[data-select="category-dropdown"] input:checked')
		).map(input => input.id);
		const selectedSectors = Array.from(
			document.querySelectorAll('[data-select="sector-dropdown"] input:checked')
		).map(input => input.id);
	
		// Send the search query via Fetch API
		const response = await fetch('/api/search/', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': getCookie('csrftoken'), // Make sure CSRF token is included for Django
			},
			body: JSON.stringify({
				keyword,
				categories: selectedCategories,
				sectors: selectedSectors,
			}),
		});
	
		const data = await response.json();
	
		// Display results or "not found" message
		const resultsContainer = document.querySelector('.find-campaign-items-container');
		resultsContainer.innerHTML = '';
	
		if (data.length > 0) {
			data.forEach(item => {
				const resultItem = document.createElement('div');
				resultItem.className = 'find-campaign-item';
				resultItem.innerHTML = `
					<img
							class="feature-img mt-2"
							src="../static/img/hero-banner-(1).jpeg"
							alt="feature image"
							/>
							<div class="feature-desc-container">
								<h5 class="page-sub-h5-head">
									${item.campaign_name}
								</h5>
								<p class="mac-text-sm my-2">
									Helping children to admissions to school getting Helping
									children to admissions to school ang getting
								</p>

								<div class="">
									<div class="location-container pe-2">
										<div class="location-val-container d-flex gap-2">
											<img
											class="location-icon"
											src="../static/img/location-icon.png"
											alt="location icon"
											/>
											<p class="location-name page-mini-head d-flex">
											<span class="highlight-span-clr me-1"
												>Accra,</span
											>
											${item.country}
											</p>
										</div>

										<div class="mt-3">
											<p class="bold-p">$23, 000</p>
											<span class="bold-p highlight-span-clr">
											30% FUNDED
											</span>
										</div>
									</div>
								</div>
							</div>
				`;
				resultsContainer.appendChild(resultItem);
			});
		} else {
			resultsContainer.innerHTML = '<p>No search results found.</p>';
		}
	});
	
	// Helper function to get CSRF token
	function getCookie(name) {
		let cookieValue = null;
		if (document.cookie && document.cookie !== '') {
			const cookies = document.cookie.split(';');
			for (let i = 0; i < cookies.length; i++) {
				const cookie = cookies[i].trim();
				if (cookie.startsWith(name + '=')) {
					cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
					break;
				}
			}
		}
		return cookieValue;
	}
	
</script>

{% endblock content %}